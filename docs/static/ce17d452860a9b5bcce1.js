(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{158:function(e,t,n){"use strict";n.r(t);n(23);var r=n(4);n(14);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}var d=n(29);function h(e,t){return!t||"object"!==Object(d.a)(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,p){return(f=Object.setPrototypeOf||function(e,p){return e.__proto__=p,e})(e,p)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}var _,w,x,k,y,I=function(){function e(t,n,r){o(this,e),this.dbName=t,this.storeName=n,this.keyName=r}var t,n,c;return l(e,[{key:"getTransaction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"readwrite";return this.db.transaction(e,t)}},{key:"getStore",value:function(){return this.getTransaction([this.storeName]).objectStore(this.storeName)}},{key:"add",value:function(data){this.getStore().add(data).onsuccess=function(){console.log("save success.")}}},{key:"remove",value:function(e){console.log(e),this.getStore().delete(e).onsuccess=function(){console.log("delete success.")}}},{key:"update",value:function(e,data){data[this.keyName]=e,this.getStore().put(data).onsuccess=function(){console.log("update success.")}}},{key:"get",value:(c=Object(r.a)(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var o=n.getStore().get(t);o.onsuccess=function(){var t=o.result;e(t)},o.onerror=r})));case 1:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"getCount",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.getStore().count();r.onsuccess=function(){e(r.result)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"getAll",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=[];t.getStore().openCursor().onsuccess=function(t){var cursor=t.target.result;if(cursor){var n=cursor.value;r.push(n),cursor.continue()}e(r)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}],[{key:"DB_NAME",get:function(){return this.dbName}},{key:"STORE_NAME",get:function(){return this.storeName}}]),e}(),C=new(function(e){function t(){return o(this,t),h(this,m(t).call(this,"ShopDB","shop","shop_id"))}var n;return v(t,e),l(t,[{key:"connect",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(t.db)e(t);else{var r=indexedDB.open(t.dbName);r.onupgradeneeded=function(e){e.target.result.createObjectStore(t.storeName,{keyPath:t.keyName,autoIncrement:!0})},r.onsuccess=function(n){t.db=n.target.result,e(t)}}})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})}]),t}(I)),S=new(function(e){function t(){return o(this,t),h(this,m(t).call(this,"ItemDB","item","item_id"))}var n,c;return v(t,e),l(t,[{key:"connect",value:(c=Object(r.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(t.db)e(t);else{var r=indexedDB.open(t.dbName);r.onupgradeneeded=function(e){e.target.result.createObjectStore(t.storeName,{keyPath:t.keyName,autoIncrement:!0}).createIndex("parent_id","parent_id",{unique:!1})},r.onsuccess=function(n){t.db=n.target.result,e(t)}}})));case 1:case"end":return e.stop()}}),e)}))),function(){return c.apply(this,arguments)})},{key:"getChilds",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var o=[],c=n.getStore(),l=IDBKeyRange.only(t),d=c.index("parent_id").openCursor(l,"next");d.onsuccess=function(){var cursor=d.result;if(cursor){var t=cursor.value;o.push(t),cursor.continue()}e(o)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]),t}(I)),A=new(function(e){function t(){return o(this,t),h(this,m(t).call(this,"PriceDB","price","idx_key"))}var n,c;return v(t,e),l(t,[{key:"connect",value:(c=Object(r.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(t.db)e(t);else{var r=indexedDB.open(t.dbName);r.onupgradeneeded=function(e){var n=e.target.result.createObjectStore(t.storeName,{keyPath:t.keyName});n.createIndex("item_id","item_id",{unique:!1}),n.createIndex("shop_id","shop_id",{unique:!1})},r.onsuccess=function(n){t.db=n.target.result,e(t)}}})));case 1:case"end":return e.stop()}}),e)}))),function(){return c.apply(this,arguments)})},{key:"genIdxKey",value:function(e,t){return e+";"+t}},{key:"save",value:function(e,t,n){var data={idx_key:this.genIdxKey(e,t),item_id:e,shop_id:t,price:n,updated:Math.floor((new Date).getTime()/1e3)};this.getStore().put(data).onsuccess=function(){console.log("price save success.")}}},{key:"getByItemId",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var o=[],c=n.getStore(),l=IDBKeyRange.only(t),d=c.index("item_id").openCursor(l,"next");d.onsuccess=function(){var cursor=d.result;if(cursor){var t=cursor.value;o.push(t),cursor.continue()}e(o)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]),t}(I));function P(e,t){var n=parseInt(e)/parseInt(t)*100;return n=Math.round(10*n)/10}var R={props:["shopdatas","item1datas"],data:function(){return{sumresult:[{name:"単価",value:""}],sumresult_cols:[{field:"name",label:"",width:"70%",numeric:!0},{field:"value",label:"",width:"30%"}],unit_price:0,item2datas:[],showItem2:!1,showItem3:!1,showAddItem:!1,showAddItemButtonP:!0,showAddItemButtonM:!1,showAddShopButtonP:!0,showAddShopButtonM:!1,shop_add:"",item_add:"",item_add_sub:0}},methods:{calcPrice:function(){var e=this.yen,t=this.weight;if(e)if(t){var n=P(e,t);this.sumresult=[{name:"単価",value:n.toLocaleString()+"円"}],this.unit_price=n}else alert("重量・容積を入力してください。");else alert("価格を入力してください。")},saveShopName:(y=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.connect();case 2:if(t=e.sent,n=this.shop_add){e.next=7;break}return alert("店舗名を入力してください。"),e.abrupt("return");case 7:return this.shop_add="",t.add({shop_name:n}),e.next=11,t.getAll();case 11:this.shopdatas=e.sent;case 12:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)}),saveItem:(k=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.connect();case 2:if(t=e.sent,n=this.item_add){e.next=7;break}return alert("品目を入力してください。"),e.abrupt("return");case 7:return r=0,1==this.item_add_sub&&(r=this.item_1,this.item_add_sub=0),this.item_add="",t.add({item_name:n,parent_id:r}),e.next=13,t.getChilds(0);case 13:if(this.item1datas=e.sent,0==r){e.next=18;break}return e.next=17,t.getChilds(r);case 17:this.item2datas=e.sent;case 18:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)}),getItem2Datas:(x=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.item_1,e.next=3,S.connect();case 3:return n=e.sent,e.next=6,n.getChilds(t);case 6:r=e.sent,this.item2datas=r;case 8:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)}),savePrice:(w=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.yen,n=this.weight,t){e.next=5;break}return alert("価格を入力してください。"),e.abrupt("return");case 5:if(n){e.next=8;break}return alert("重量・容積を入力してください。"),e.abrupt("return");case 8:if(r=P(t,n),this.sumresult=[{name:"単価",value:r.toLocaleString()+"円"}],this.unit_price=r,o=0,!this.item_2){e.next=16;break}o=parseInt(this.item_2),e.next=22;break;case 16:if(!this.item_1){e.next=20;break}o=parseInt(this.item_1),e.next=22;break;case 20:return alert("品目を指定してください。"),e.abrupt("return");case 22:if(c=this.shop){e.next=26;break}return alert("店舗を指定してください。"),e.abrupt("return");case 26:return e.next=28,A.connect();case 28:e.sent.save(o,c,this.unit_price),this.$buefy.toast.open("この単価を指定の品目,店舗について登録しました。");case 31:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)}),comparePrice:(_=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.yen,n=this.weight,t){e.next=5;break}return alert("価格を入力してください。"),e.abrupt("return");case 5:if(n){e.next=8;break}return alert("重量・容積を入力してください。"),e.abrupt("return");case 8:if(r=P(t,n),this.sumresult=[{name:"単価",value:r.toLocaleString()+"円"}],this.unit_price=r,o=0,!this.item_2){e.next=16;break}o=this.item_2,e.next=22;break;case 16:if(!this.item_1){e.next=20;break}o=this.item_1,e.next=22;break;case 20:return alert("品目を指定してください。"),e.abrupt("return");case 22:this.$nuxt.$emit("COMPARE_EVENT",{unit_price:r,item_id:o});case 23:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})}},O=n(28),B={data:function(){return{columns:[{field:"mark",label:"評価"},{field:"price",label:"グラム単価(円)"},{field:"shop",label:"店舗"},{field:"lastmodified",label:"最終更新"}]}},props:["calcresult"],created:function(){var e=this;this.$nuxt.$on("COMPARE_EVENT",function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(data){var n,r,o,c,l,d,h,i,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=data.unit_price,r=data.item_id,e.calcresult=[],e.calcresult.push({mark:"",price:n,shop:"現在地",lastmodified:""}),t.next=6,C.connect();case 6:return o=t.sent,t.next=9,A.connect();case 9:return c=t.sent,t.next=12,c.getByItemId(r);case 12:l=t.sent,d=n,h=0,i=0;case 16:if(!(i<l.length)){t.next=26;break}return d>Math.floor(l[i].price)&&(d=Math.floor(l[i].price),h=i+1),e.calcresult.push({mark:"",price:l[i].price,shop:"",lastmodified:e.$ts2date(l[i].updated)}),t.next=21,o.get(l[i].shop_id);case 21:(m=t.sent)&&(e.calcresult[i+1].shop=m.shop_name);case 23:i++,t.next=16;break;case 26:e.calcresult[h].mark="さいやす！！",e.calcresult.sort((function(a,b){return a.price<b.price?-1:a.price>b.price?1:0}));case 28:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},j={components:{topView:Object(O.a)(R,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"section"},[n("div",{staticClass:"columns is-mobile"},[n("div",{staticClass:"column is-half"},[n("b-field",{attrs:{label:"価格(円)"}},[n("b-input",{attrs:{type:"number"},model:{value:e.yen,callback:function(t){e.yen=t},expression:"yen"}})],1)],1),e._v(" "),n("div",{staticClass:"column is-half"},[n("b-field",{attrs:{label:"重量・容積"}},[n("b-input",{attrs:{type:"number"},model:{value:e.weight,callback:function(t){e.weight=t},expression:"weight"}})],1)],1)]),e._v(" "),n("div",{staticClass:"columns"},[n("div",{staticClass:"column is-full"},[n("div",{staticClass:"buttons",staticStyle:{float:"right"}},[n("b-button",{on:{click:e.calcPrice}},[e._v("Calcurate!!")])],1),e._v(" "),n("br",{attrs:{clear:"both"}}),e._v(" "),n("b-table",{attrs:{data:e.sumresult,columns:e.sumresult_cols,"has-modal-cards":!1,"mobile-cards":!1}})],1)]),e._v(" "),n("hr"),e._v(" "),n("b-field",{attrs:{label:"品目"}},[n("div",{staticClass:"columns"},[n("div",{staticClass:"column is-half"},[n("b-select",{attrs:{expanded:"true"},on:{input:function(t){e.getItem2Datas(),e.showItem2=!0}},model:{value:e.item_1,callback:function(t){e.item_1=t},expression:"item_1"}},e._l(e.item1datas,(function(t){return n("option",{domProps:{value:t.item_id}},[e._v(e._s(t.item_name))])})),0)],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.showItem2,expression:"showItem2"}],staticClass:"column is-half"},[n("b-select",{attrs:{expanded:"true"},model:{value:e.item_2,callback:function(t){e.item_2=t},expression:"item_2"}},[n("option",{attrs:{value:"0"}},[e._v("(選択なし)")]),e._v(" "),e._l(e.item2datas,(function(t){return n("option",{domProps:{value:t.item_id}},[e._v(e._s(t.item_name))])}))],2)],1)])]),e._v(" "),n("div",{staticClass:"columns"},[n("div",{staticClass:"column is-full"},[n("b-button",{directives:[{name:"show",rawName:"v-show",value:e.showAddItemButtonP,expression:"showAddItemButtonP"}],on:{click:function(t){e.showAddItemButtonP=!1,e.showAddItemButtonM=!0,e.showAddItem=!0}}},[e._v("+")]),e._v(" "),n("b-button",{directives:[{name:"show",rawName:"v-show",value:e.showAddItemButtonM,expression:"showAddItemButtonM"}],on:{click:function(t){e.showAddItemButtonP=!0,e.showAddItemButtonM=!1,e.showAddItem=!1}}},[e._v("-")])],1)]),e._v(" "),n("b-field",{directives:[{name:"show",rawName:"v-show",value:e.showAddItem,expression:"showAddItem"}],attrs:{label:"品目を追加"}},[n("div",{staticClass:"columns"},[n("div",{staticClass:"column is-10"},[n("b-input",{attrs:{type:"text"},model:{value:e.item_add,callback:function(t){e.item_add=t},expression:"item_add"}}),n("br"),e._v(" "),n("b-checkbox",{attrs:{"true-value":"1","false-value":"0"},model:{value:e.item_add_sub,callback:function(t){e.item_add_sub=t},expression:"item_add_sub"}},[e._v("サブ品目として登録")])],1),e._v(" "),n("div",{staticClass:"column is-2"},[n("b-button",{on:{click:e.saveItem}},[e._v("Add")])],1)])]),e._v(" "),n("b-field",{attrs:{label:"店舗"}},[n("div",{staticClass:"columns"},[n("div",{staticClass:"column is-full"},[n("b-select",{attrs:{expanded:"true"},model:{value:e.shop,callback:function(t){e.shop=t},expression:"shop"}},e._l(e.shopdatas,(function(t){return n("option",{domProps:{value:t.shop_id}},[e._v(e._s(t.shop_name))])})),0)],1)])]),e._v(" "),n("div",{staticClass:"columns"},[n("div",{staticClass:"column is-full"},[n("b-button",{directives:[{name:"show",rawName:"v-show",value:e.showAddShopButtonP,expression:"showAddShopButtonP"}],on:{click:function(t){e.showAddShopButtonP=!1,e.showAddShopButtonM=!0,e.showAddShop=!0}}},[e._v("+")]),e._v(" "),n("b-button",{directives:[{name:"show",rawName:"v-show",value:e.showAddShopButtonM,expression:"showAddShopButtonM"}],on:{click:function(t){e.showAddShopButtonP=!0,e.showAddShopButtonM=!1,e.showAddShop=!1}}},[e._v("-")])],1)]),e._v(" "),n("b-field",{directives:[{name:"show",rawName:"v-show",value:e.showAddShop,expression:"showAddShop"}],attrs:{label:"店舗を追加"}},[n("div",{staticClass:"columns"},[n("div",{staticClass:"column is-10"},[n("b-input",{attrs:{type:"text"},model:{value:e.shop_add,callback:function(t){e.shop_add=t},expression:"shop_add"}},[e._v(e._s(e.shop_add))])],1),e._v(" "),n("div",{staticClass:"column is-2"},[n("b-button",{on:{click:e.saveShopName}},[e._v("Add")])],1)])]),e._v(" "),n("div",{staticClass:"columns"},[n("div",{staticClass:"column is-full"},[n("div",{staticClass:"buttons",staticStyle:{float:"right"}},[n("b-button",{on:{click:e.comparePrice}},[e._v("Compare!!")]),e._v(" "),n("b-button",{staticStyle:{"margin-left":"15px"},on:{click:e.savePrice}},[e._v("Save")])],1),e._v(" "),n("br",{attrs:{clear:"both"}})])])],1)}),[],!1,null,null,null).exports,resultView:Object(O.a)(B,(function(){var e=this.$createElement,t=this._self._c||e;return t("section",{attrs:{id:"resultview"}},[t("b-table",{attrs:{data:this.calcresult,columns:this.columns}})],1)}),[],!1,null,null,null).exports},data:function(){return{calcresult:[]}},asyncData:function(e){return Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.connect();case 2:return t=e.sent,e.next=5,t.getAll();case 5:return n=e.sent,e.next=8,S.connect();case 8:return e.sent,e.next=11,S.getChilds(0);case 11:return r=e.sent,e.abrupt("return",{shopdatas:n,item1datas:r});case 13:case"end":return e.stop()}}),e)})))()}},N=Object(O.a)(j,(function(){var e=this.$createElement,t=this._self._c||e;return t("section",{staticClass:"section"},[t("top-view",{attrs:{shopdatas:this.shopdatas,item1datas:this.item1datas}}),this._v(" "),t("hr"),this._v(" "),t("result-view",{attrs:{calcresult:this.calcresult}})],1)}),[],!1,null,null,null);t.default=N.exports}}]);